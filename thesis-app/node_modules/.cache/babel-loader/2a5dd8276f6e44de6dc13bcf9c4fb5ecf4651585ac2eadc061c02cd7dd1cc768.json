{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\User\\\\Documents\\\\GitHub\\\\ThesesTracker\\\\thesis-app\\\\src\\\\App.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { supabase } from \"./lib/helper/supabaseClient.js\";\nimport Login from './login/Login.jsx';\nimport AdminLogin from './login/AdminLogin.jsx';\nimport StudentLogin from './login/StudentLogin.jsx';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function App() {\n  _s();\n  const [user, setUser] = useState(null);\n  const [role, setRole] = useState(null);\n  useEffect(() => {\n    // Function to fetch role from PostgreSQL based on userID\n    const fetchUserRole = async userId => {\n      var _data$;\n      const {\n        data,\n        error\n      } = await supabase.from('user_roles') // SQL Table name\n      .select('role') // the uhhhh table component containing the roles\n      .eq('user_id', userId);\n      if (error) {\n        console.error('Error fetching role:', error);\n        return null;\n      }\n      return (_data$ = data[0]) === null || _data$ === void 0 ? void 0 : _data$.role; // Assuming only one role per user\n    };\n    const getUser = async () => {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (user) {\n        //check if using institutional email\n        if (!user.email.endsWith(\"@neu.edu.ph\")) {\n          alert(\"Please use your NEU email to log in.\");\n          logout();\n        } else {\n          setUser(user);\n          // Fetch role from the database (PostgreSQL)\n          const userRole = await fetchUserRole(user.id);\n          setRole(userRole);\n        }\n      }\n    };\n    getUser();\n    const {\n      data: {\n        subscription\n      }\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      setUser((session === null || session === void 0 ? void 0 : session.user) || null);\n      if (session !== null && session !== void 0 && session.user) {\n        fetchUserRole(session.user.id).then(setRole); // Fetch role on session change\n      }\n    });\n    return () => {\n      subscription.unsubscribe();\n    };\n  }, []);\n  const logout = async () => {\n    await supabase.auth.signOut();\n    setUser(null);\n    setRole(null);\n  };\n  if (!user) {\n    return /*#__PURE__*/_jsxDEV(Login, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 12\n    }, this);\n  }\n  if (role) {\n    if (role == \"admin\") {\n      return /*#__PURE__*/_jsxDEV(AdminLogin, {\n        logout: logout\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 14\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(StudentLogin, {\n        logout: logout\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 14\n      }, this);\n    }\n  }\n}\n_s(App, \"iTY3qP3pH2KEmGVhPeeHSfaPq48=\");\n_c = App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useState","useEffect","supabase","Login","AdminLogin","StudentLogin","jsxDEV","_jsxDEV","App","_s","user","setUser","role","setRole","fetchUserRole","userId","_data$","data","error","from","select","eq","console","getUser","auth","email","endsWith","alert","logout","userRole","id","subscription","onAuthStateChange","_event","session","then","unsubscribe","signOut","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/User/Documents/GitHub/ThesesTracker/thesis-app/src/App.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { supabase } from \"./lib/helper/supabaseClient.js\";\r\nimport Login from './login/Login.jsx';\r\nimport AdminLogin from './login/AdminLogin.jsx';\r\nimport StudentLogin from './login/StudentLogin.jsx';\r\n\r\nexport default function App() {\r\n  const [user, setUser] = useState(null);\r\n  const [role, setRole] = useState(null);\r\n\r\n  useEffect(() => {\r\n    \r\n    // Function to fetch role from PostgreSQL based on userID\r\n    const fetchUserRole = async (userId) => {\r\n      const { data, error } = await supabase\r\n        .from('user_roles') // SQL Table name\r\n        .select('role') // the uhhhh table component containing the roles\r\n        .eq('user_id', userId);\r\n\r\n      if (error) {\r\n        console.error('Error fetching role:', error);\r\n        return null;\r\n      }\r\n\r\n      return data[0]?.role; // Assuming only one role per user\r\n    };\r\n\r\n    const getUser = async () => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (user) {\r\n\r\n        //check if using institutional email\r\n        if(!user.email.endsWith(\"@neu.edu.ph\")){\r\n          alert(\"Please use your NEU email to log in.\");\r\n          logout();\r\n        }\r\n        else{\r\n          setUser(user);\r\n          // Fetch role from the database (PostgreSQL)\r\n          const userRole = await fetchUserRole(user.id);\r\n          setRole(userRole);\r\n        } \r\n      }\r\n    };\r\n\r\n    getUser();\r\n\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\r\n      setUser(session?.user || null);\r\n      if (session?.user) {\r\n        fetchUserRole(session.user.id).then(setRole); // Fetch role on session change\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  const logout = async () => {\r\n    await supabase.auth.signOut();\r\n    setUser(null);\r\n    setRole(null);\r\n  };\r\n\r\n  if(!user){\r\n    return <Login />\r\n  }\r\n  \r\n  if(role){\r\n    if(role == \"admin\"){\r\n      return <AdminLogin logout={logout} />\r\n    }\r\n    else{\r\n      return <StudentLogin logout={logout} />\r\n    }\r\n  }\r\n\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}